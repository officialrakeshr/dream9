<div class="grid">
  <div class="col-12">
    <p-card header="Match Details">
      <div class="match-det">
        <p-button label="Enrol Dream9 Players" styleClass="p-button-link" (click)="enrolPlayerModal = !enrolPlayerModal" ></p-button>
        <p-button label="Score Book" styleClass="p-button-link" [routerLink]="['../scorebook']" ></p-button>
        <h5>Match Number :</h5>
        <p-dropdown
          [options]="(tournaments$ | async) || []"
          [(ngModel)]="selectedMatch"
          #match
          (onChange)="getMatchDetails(match.value)"
          placeholder="Select a Match"
          optionLabel="matchNo"
        ></p-dropdown>
        <ng-container *ngIf="matchDetails$ | async as matchDetails">
          <h5>
            {{ matchDetails.team1.name }} vs {{ matchDetails.team2.name }}
          </h5>

          <div
            class="flex flex-wrap justify-content-center card-container blue-container gap-3"
          >
            <p-table
              [value]="matchDetails.team1.players"
              styleClass="p-datatable-gridlines"
              [tableStyle]="{ 'max-width': '50rem' }"
            >
              <ng-template pTemplate="caption">
                Team 1: {{ matchDetails.team1.name }}
              </ng-template>
              <ng-template pTemplate="header">
                <tr>
                  <th>Name</th>
                  <th>Active</th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-product>
                <tr>
                  <td>{{ product.name }}</td>
                  <td
                    *ngIf="
                      !(!selectedMatch.enable11 && !selectedMatch.completed)
                    "
                  >
                    {{ product.active }}
                  </td>
                  <td
                    pEditableColumn
                    *ngIf="!selectedMatch.enable11 && !selectedMatch.completed"
                  >
                    <p-cellEditor>
                      <ng-template pTemplate="input">
                        <p-dropdown
                          [options]="playerOptions"
                          [(ngModel)]="product.active"
                          optionLabel="name"
                          optionValue="value"
                        ></p-dropdown>
                      </ng-template>
                      <ng-template pTemplate="output">
                        {{ product.active }}
                      </ng-template>
                    </p-cellEditor>
                  </td>
                </tr>
              </ng-template>
            </p-table>
            <p-table
              [value]="matchDetails.team2.players"
              styleClass="p-datatable-gridlines"
              [tableStyle]="{ 'max-width': '50rem' }"
            >
              <ng-template pTemplate="caption">
                Team 2: {{ matchDetails.team2.name }}
              </ng-template>
              <ng-template pTemplate="header">
                <tr>
                  <th>Name</th>
                  <th>Active</th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-product>
                <tr>
                  <td>{{ product.name }}</td>
                  <td
                    *ngIf="
                      !(!selectedMatch.enable11 && !selectedMatch.completed)
                    "
                  >
                    {{ product.active }}
                  </td>
                  <td
                    pEditableColumn
                    *ngIf="!selectedMatch.enable11 && !selectedMatch.completed"
                  >
                    <p-cellEditor>
                      <ng-template pTemplate="input">
                        <p-dropdown
                          [options]="playerOptions"
                          [(ngModel)]="product.active"
                          optionLabel="name"
                          optionValue="value"
                        ></p-dropdown>
                      </ng-template>
                      <ng-template pTemplate="output">
                        {{ product.active }}
                      </ng-template>
                    </p-cellEditor>
                  </td>
                </tr>
              </ng-template>
            </p-table>
          </div>
          <br />
          <button
            pButton
            pRipple
            type="button"
            label="Update Players"
            *ngIf="!selectedMatch.started &&!selectedMatch.enable11 && !selectedMatch.completed"
            (click)="updatePlayers(matchDetails)"
            class="p-button-outlined"
          ></button>
          <button
            pButton
            pRipple
            type="button"
            label="Enable Dream9"
            *ngIf="!selectedMatch.completed && !selectedMatch.started && !selectedMatch.enable11"
            (click)="enableDream9(selectedMatch)"
            class="p-button-outlined"
          ></button>
          <button
            pButton
            pRipple
            type="button"
            label="Close Dream9"
            *ngIf="!selectedMatch.started && !selectedMatch.completed && selectedMatch.enable11"
            (click)="closeDream9(selectedMatch)"
            class="p-button-outlined"
          ></button>
          <button
            pButton
            pRipple
            type="button"
            label="Start Match"
            *ngIf="!selectedMatch.completed && !selectedMatch.started"
            (click)="startMatch(selectedMatch)"
            class="p-button-outlined"
          ></button>
        </ng-container>
      </div>
    </p-card>
  </div>
</div>

<p-dialog header="New Dream9 Player Creation" [(visible)]="enrolPlayerModal">
  <label for="password" class="block text-900 font-medium mb-2"
    >Match Number</label
  >
  <p-dropdown
    [options]="(tournaments$ | async) || []"
    [(ngModel)]="selectedMatchNo"
    placeholder="Select a Match"
    optionLabel="matchNo"
    optionValue="matchNo"
  ></p-dropdown>
  <label for="name" class="block text-900 font-medium mb-2">Name</label>
  <input id="name" type="text" #username pInputText class="w-full mb-3" />
  <label for="phone" class="block text-900 font-medium mb-2">Phone</label>
  <input id="phone" type="number" #phone pInputText class="w-full mb-3" />
  <h3>Unique ID: {{newUniqueId}}<button (click)="makeid()">Generate</button></h3>
  <button pButton pRipple label="Enrol User" icon="pi pi-user" class="w-full"
                    (click)="generateUser(selectedMatchNo,username.value,phone.value,newUniqueId)"></button>
</p-dialog>
